{% extends "base.html" %}

{% block content %}
<div class="dashboard">
    <header>
        <h1>Welcome, {{ session.user.name }}!</h1>
    </header>

    <div class="dashboard-content">
        <h2>Your Nest</h2>

        <!-- Main dashboard content -->
        <div class="dashboard-main">
            <p>This is your dashboard. Here you can manage your profile and house listings.</p>
        </div>


        <!-- Profile Section -->
        <div class="profile-section">
            <h3>Your Roommate Profile</h3>

            {% if profile and not profile.archived %}
            <div class="profile-status active">
                <p>Your profile is currently <strong>active</strong> and visible to others.</p>
            </div>
            {% elif profile and profile.archived %}
            <div class="profile-status archived">
                <p>Your profile is currently <strong>archived</strong> and not visible to others.</p>
            </div>
            {% else %}
            <div class="profile-status missing">
                <p>You haven't created a profile yet. Complete your profile to find roommates.</p>
            </div>
            {% endif %}

            <form method="POST" action="{{ url_for('handle_profile') }}" enctype="multipart/form-data"
                class="profile-form">
                <div class="form-toggle">
                    <button type="button" class="toggle-button" onclick="toggleProfileForm()">
                        {% if profile %}Edit Profile{% else %}Create Profile{% endif %}
                    </button>
                </div>

                <div id="profileForm" style="display: {% if not profile %}block{% else %}none{% endif %};">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="name">Full Name</label>
                            <input type="text" id="name" name="name" value="{{ profile.name if profile }}" required>
                        </div>

                        <div class="form-group">
                            <label for="gender">Gender</label>
                            <select id="gender" name="gender" required>
                                <option value="Male" {% if profile and profile.gender=='Male' %}selected{% endif %}>Male
                                </option>
                                <option value="Female" {% if profile and profile.gender=='Female' %}selected{% endif %}>
                                    Female</option>
                                <option value="Other" {% if profile and profile.gender=='Other' %}selected{% endif %}>
                                    Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="nationality">Nationality</label>
                            <input type="text" id="nationality" name="nationality"
                                value="{{ profile.nationality if profile }}" required>
                        </div>

                        <div class="form-group">
                            <label for="intake">Intake</label>
                            <input type="text" id="intake" name="intake" value="{{ profile.intake if profile }}"
                                placeholder="e.g., Jan 2024" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="degreeProgram">Degree Program</label>
                        <input type="text" id="degreeProgram" name="degreeProgram"
                            value="{{ profile.degreeProgram if profile }}" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="budget_min">Budget Range (Min)</label>
                            <input type="number" id="budget_min" name="budget_min"
                                value="{{ profile.budgetRange.min if profile }}" required>
                        </div>

                        <div class="form-group">
                            <label for="budget_max">Budget Range (Max)</label>
                            <input type="number" id="budget_max" name="budget_max"
                                value="{{ profile.budgetRange.max if profile }}" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="lookingFor">Looking for a roommate who is</label>
                        <select id="lookingFor" name="lookingFor" required>
                            <option value="Male" {% if profile and profile.lookingFor=='Male' %}selected{% endif %}>Male
                            </option>
                            <option value="Female" {% if profile and profile.lookingFor=='Female' %}selected{% endif %}>
                                Female</option>
                            <option value="No Preference" {% if profile and profile.lookingFor=='No Preference'
                                %}selected{% endif %}>No Preference</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="personalityTrait">Personality Trait</label>
                        <select id="personalityTrait" name="personalityTrait" required>
                            <option value="Introvert" {% if profile and profile.personalityTrait=='Introvert'
                                %}selected{% endif %}>Introvert</option>
                            <option value="Extrovert" {% if profile and profile.personalityTrait=='Extrovert'
                                %}selected{% endif %}>Extrovert</option>
                            <option value="Ambivert" {% if profile and profile.personalityTrait=='Ambivert' %}selected{%
                                endif %}>Ambivert</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea id="description" name="description" rows="4"
                            required>{% if profile %}{{ profile.description }}{% endif %}</textarea>
                    </div>

                    <div class="form-group">
                        <label for="profile_picture">Profile Picture</label>
                        <input type="file" id="profile_picture" name="profile_picture" accept="image/*"
                            class="form-control">
                        {% if profile and profile.profilePicture %}
                        <div class="current-picture">
                            <p>Current Picture:</p>
                            <img src="{{ url_for('static', filename='uploads/profile_pictures/' + profile.profilePicture) }}"
                                alt="Profile Picture" class="img-thumbnail" width="150">
                            <div class="mt-2">
                                <button type="button" class="btn btn-sm btn-outline-danger"
                                    onclick="confirmRemovePicture()">
                                    Remove Picture
                                </button>
                            </div>
                        </div>
                        {% endif %}
                        <small class="form-text text-muted">Allowed formats: JPG, PNG, GIF (Max 2MB)</small>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Save Profile</button>

                        {% if profile and not profile.archived %}
                        <button type="button" class="btn btn-secondary" onclick="showArchiveForm()">Archive
                            Profile</button>
                        {% endif %}
                    </div>

                    {% if profile and not profile.archived %}
                    <div id="archiveForm" style="display: none; margin-top: 20px;">
                        <div class="form-group">
                            <label for="archived_reason">Reason for archiving</label>
                            <input type="text" id="archived_reason" name="archived_reason" placeholder="Optional">
                        </div>
                        <button type="submit" name="action" value="archive" class="btn btn-warning">Confirm
                            Archive</button>
                    </div>
                    {% endif %}
                </div>
            </form>

            {% if profile %}
            <div class="profile-preview">
                <h4>Profile Preview</h4>
                <div class="preview-content">
                    <div class="preview-row">
                        <span class="preview-label">Name:</span>
                        <span class="preview-value">{{ profile.name }}</span>
                    </div>
                    <div class="preview-row">
                        <span class="preview-label">Gender:</span>
                        <span class="preview-value">{{ profile.gender }}</span>
                    </div>
                    <div class="preview-row">
                        <span class="preview-label">Nationality:</span>
                        <span class="preview-value">{{ profile.nationality }}</span>
                    </div>
                    <div class="preview-row">
                        <span class="preview-label">Budget Range:</span>
                        <span class="preview-value">${{ profile.budgetRange.min }} - ${{ profile.budgetRange.max
                            }}</span>
                    </div>
                    <div class="preview-row">
                        <span class="preview-label">Looking For:</span>
                        <span class="preview-value">{{ profile.lookingFor }}</span>
                    </div>
                    <div class="preview-row">
                        <span class="preview-label">Personality:</span>
                        <span class="preview-value">{{ profile.personalityTrait }}</span>
                    </div>
                    <div class="preview-row">
                        <span class="preview-label">Description:</span>
                        <span class="preview-value">{{ profile.description }}</span>
                    </div>
                    {% if profile.profilePicture %}
                    <div class="preview-row">
                        <span class="preview-label">Profile Picture:</span>
                        <span class="preview-value">
                            <img src="{{ url_for('static', filename='uploads/profile_pictures/' + profile.profilePicture) }}"
                                alt="Profile Picture" width="80">
                        </span>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Remove Picture Confirmation Modal -->
        <div class="modal fade" id="removePictureModal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Remove Profile Picture</h5>

                    </div>
                    <div class="modal-body">
                        Are you sure you want to remove your profile picture?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger" onclick="removeProfilePicture()">Remove</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- House Listings Section -->
        <div class="house-listings-section">
            <h3>Your House Listings</h3>

            <div class="house-listings-actions">
                <button type="button" class="btn btn-primary" onclick="toggleHouseForm()">
                    Add New Listing
                </button>
            </div>

            <form id="houseListingForm" method="POST" action="{{ url_for('handle_house_listing') }}"
                enctype="multipart/form-data" style="display: none;">
                <input type="hidden" id="listing_id" name="listing_id">

                <div class="form-row">
                    <div class="form-group">
                        <label for="rent_per_room_rwf">Rent per Room (RWF)</label>
                        <input type="number" id="rent_per_room_rwf" name="rent_per_room_rwf" required>
                    </div>

                    <div class="form-group">
                        <label for="location">Location</label>
                        <input type="text" id="location" name="location" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="num_bedrooms">Number of Bedrooms</label>
                        <input type="number" id="num_bedrooms" name="num_bedrooms" required>
                    </div>

                    <div class="form-group">
                        <label for="num_bathrooms">Number of Bathrooms</label>
                        <input type="number" id="num_bathrooms" name="num_bathrooms" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" name="description" rows="4" required></textarea>
                </div>

                <div class="form-group">
                    <label>Amenities</label>
                    <div class="amenities-checkboxes">
                        <div class="amenity-item">
                            <input type="checkbox" id="furnished" name="furnished">
                            <label for="furnished">Furnished</label>
                        </div>
                        <div class="amenity-item">
                            <input type="checkbox" id="electricity_included" name="electricity_included">
                            <label for="electricity_included">Electricity Included</label>
                        </div>
                        <div class="amenity-item">
                            <input type="checkbox" id="security_guard" name="security_guard">
                            <label for="security_guard">Security Guard</label>
                        </div>
                        <div class="amenity-item">
                            <input type="checkbox" id="water_included" name="water_included">
                            <label for="water_included">Water Included</label>
                        </div>
                        <div class="amenity-item">
                            <input type="checkbox" id="wifi_included" name="wifi_included">
                            <label for="wifi_included">WiFi Included</label>
                        </div>
                        <div class="amenity-item">
                            <input type="checkbox" id="washing_machine" name="washing_machine">
                            <label for="washing_machine">Washing Machine</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="status">Status</label>
                    <select id="status" name="status" required>
                        <option value="available">Available</option>
                        <option value="rented">Rented</option>
                        <option value="archived">Archived</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="house_images">Upload Images (Max 5)</label>
                    <input type="file" id="house_images" name="house_images" accept="image/*" multiple>
                    <small class="form-text text-muted">Allowed formats: JPG, PNG (Max 5MB each)</small>

                    <div id="image-preview" class="image-preview-container">
                        <!-- Preview of existing images will go here -->
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Save Listing</button>
                    <button type="button" class="btn btn-secondary" onclick="toggleHouseForm()">Cancel</button>
                    <button type="button" id="deleteBtn" class="btn btn-danger" style="display: none;"
                        onclick="confirmDeleteListing()">Delete Listing</button>
                </div>
            </form>

            <!-- House Listings Table -->
            <div class="house-listings-table">
                {% if house_listings and house_listings|length > 0 %}
                <table>
                    <thead>
                        <tr>
                            <th>Location</th>
                            <th>Rent</th>
                            <th>Bed/Bath</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for listing in house_listings %}
                        <tr>
                            <td>{{ listing.location }}</td>
                            <td>{{ "{:,}".format(listing.rent_per_room_rwf) }} RWF</td>
                            <td>{{ listing.num_bedrooms }} / {{ listing.num_bathrooms }}</td>
                            <td>
                                <span class="status-badge {{ listing.status }}">{{ listing.status|capitalize }}</span>
                            </td>
                            <td class="actions">
                                <button class="btn-edit" onclick="editListing('{{ listing._id }}')">
                                    Edit
                                </button>
                                {% if listing.status != 'archived' %}
                                <button class="btn-archive" onclick="archiveListing('{{ listing._id }}')">
                                    <i class="fas fa-archive"></i> Archive
                                </button>
                                {% else %}
                                <button class="btn-activate" onclick="activateListing('{{ listing._id }}')">
                                    <i class="fas fa-check"></i> Activate
                                </button>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="no-listings">
                    <p>You don't have any house listings yet. Create your first listing to get started.</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Delete Listing Confirmation Modal -->
        <div class="modal fade" id="deleteListingModal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Delete Listing</h5>
                    </div>
                    <div class="modal-body">
                        Are you sure you want to delete this listing? This action cannot be undone.
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger" onclick="deleteListing()">Delete</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% raw %}
    <script>
        // Profile JavaScript functions///////////////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        function toggleProfileForm() {
            const form = document.getElementById('profileForm');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }

        function showArchiveForm() {
            document.getElementById('archiveForm').style.display = 'block';
        }

        function confirmRemovePicture() {
            $('#removePictureModal').modal('show');
        }

        function removeProfilePicture() {
            if (!confirm('Are you sure you want to remove your profile picture?')) {
                return;
            }

            fetch("{{ url_for('remove_profile_picture') }}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Error removing picture: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred');
            });
        }

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // House listings JavaScript functions
        function toggleHouseForm() {
            const form = document.getElementById('houseListingForm');
            if (!form) {
                console.error('Form not found!');
                return;
            }
            if (form.style.display === 'none') {
                // Reset form for new listing
                form.reset();
                document.getElementById('listing_id').value = '';
                document.getElementById('deleteBtn').style.display = 'none';
                document.getElementById('image-preview').innerHTML = '';
            }
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }

        async function editListing(listingId) {
            try {
                const form = document.getElementById('houseListingForm');
                form.style.display = 'block';

                // Show loading state while we fetch the data
                const originalFormContent = form.innerHTML;
                form.innerHTML = '<div class="loading-spinner">Loading listing details...</div>';

                const response = await fetch(`/api/house_listings/${listingId}`);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.error || 'Failed to load listing data');
                }

                // Restore the original form content
                form.innerHTML = originalFormContent;

                const listing = data.listing;
                
                // Now populate the form fields
                document.getElementById('listing_id').value = listing._id || '';
                document.getElementById('rent_per_room_rwf').value = listing.rent_per_room_rwf || '';
                document.getElementById('location').value = listing.location || '';
                document.getElementById('num_bedrooms').value = listing.num_bedrooms || '';
                document.getElementById('num_bathrooms').value = listing.num_bathrooms || '';
                document.getElementById('description').value = listing.description || '';
                document.getElementById('status').value = listing.status || 'available';

                // Set checkboxes
                document.getElementById('furnished').checked = listing.furnished || false;
                document.getElementById('electricity_included').checked = listing.electricity_included || false;
                document.getElementById('security_guard').checked = listing.security_guard || false;
                document.getElementById('water_included').checked = listing.water_included || false;
                document.getElementById('wifi_included').checked = listing.wifi_included || false;
                document.getElementById('washing_machine').checked = listing.washing_machine || false;

                // Handle image previews
                const imagePreview = document.getElementById('image-preview');
                imagePreview.innerHTML = '';

                if (listing.images && listing.images.length > 0) {
                    listing.images.forEach(image => {
                        const imgContainer = document.createElement('div');
                        imgContainer.className = 'image-preview-item';
                        imgContainer.innerHTML = `
                            <img src="/uploads/house_images/${image}" alt="House Image">
                            <button type="button" class="btn-remove-image" 
                                    onclick="removeImage('${listing._id}', '${image}')"
                                    aria-label="Remove image">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                        imagePreview.appendChild(imgContainer);
                    });
                } else {
                    imagePreview.innerHTML = '<p>No images uploaded yet</p>';
                }

                // Show delete button
                document.getElementById('deleteBtn').style.display = 'inline-block';

                // Scroll to form
                form.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            } catch (error) {
                console.error('Edit Listing Error:', error);
                const form = document.getElementById('houseListingForm');
                form.innerHTML = `
                    <div class="error-message">
                        <p>Failed to load listing details</p>
                        <p><small>${error.message}</small></p>
                        <button onclick="toggleHouseForm()" class="btn btn-secondary">Close</button>
                        <button onclick="editListing('${listingId}')" class="btn btn-primary">Retry</button>
                    </div>
                `;
            }
        }

        function archiveListing(listingId) {
            if (confirm('Are you sure you want to archive this listing? It will no longer be visible to others.')) {
                updateListingStatus(listingId, 'archived');
            }
        }

        function activateListing(listingId) {
            updateListingStatus(listingId, 'available');
        }

        function updateListingStatus(listingId, status) {
            fetch(`/api/house_listings/${listingId}/status`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ status: status })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Error updating listing: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while updating the listing');
            });
        }

        function confirmDeleteListing() {
            $('#deleteListingModal').modal('show');
        }

        function deleteListing() {
            const listingId = document.getElementById('listing_id').value;
            if (!listingId) {
                alert('No listing selected for deletion');
                return;
            }

            fetch(`/api/house_listings/${listingId}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => { throw new Error(err.error); });
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    window.location.reload();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error deleting listing: ' + error.message);
            });
        }

        function removeImage(listingId, imageName) {
            if (confirm('Are you sure you want to remove this image?')) {
                fetch(`/api/house_listings/${listingId}/images`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ image_name: imageName })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        editListing(listingId);
                    } else {
                        alert('Error removing image: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while removing the image');
                });
            }
        }

        // Updated Form submission handler for unified endpoint
        document.getElementById('houseListingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const form = this;
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalBtnText = submitBtn.textContent;
            
            // Disable button during submission
            submitBtn.disabled = true;
            submitBtn.textContent = 'Saving...';
            
            const formData = new FormData(form);
            const listingId = document.getElementById('listing_id').value;
            
            // Use the same endpoint for both create and update
            fetch('/api/house_listings', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.reload();
                } else {
                    alert('Error: ' + (data.error || 'Failed to save listing'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while saving the listing');
            })
            .finally(() => {
                submitBtn.disabled = false;
                submitBtn.textContent = originalBtnText;
            });
        });

        // Preview images before upload
        document.getElementById('house_images').addEventListener('change', function(e) {
            const preview = document.getElementById('image-preview');
            preview.innerHTML = '';
            
            const files = e.target.files;
            for (let i = 0; i < Math.min(files.length, 5); i++) {
                const file = files[i];
                if (file.type.match('image.*')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imgContainer = document.createElement('div');
                        imgContainer.className = 'image-preview-item';
                        imgContainer.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                        preview.appendChild(imgContainer);
                    }
                    reader.readAsDataURL(file);
                }
            }
        });
    </script>
    {% endraw %}

    <style>
        .dashboard {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .dashboard-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .dashboard-main {
            margin-bottom: 30px;
        }

        .profile-section {
            border-top: 1px solid #eee;
            padding-top: 20px;
        }

        .profile-status {
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .profile-status.active {
            background-color: #e6f7e6;
            border-left: 4px solid #28a745;
        }

        .profile-status.archived {
            background-color: #fff3e6;
            border-left: 4px solid #fd7e14;
        }

        .profile-status.missing {
            background-color: #e6f2ff;
            border-left: 4px solid #007bff;
        }

        .form-toggle {
            margin-bottom: 15px;
        }

        .toggle-button {
            padding: 8px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .toggle-button:hover {
            background-color: #0069d9;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-group {
            flex: 1;
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-primary {
            background-color: #007bff;
            color: white;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-warning {
            background-color: #ffc107;
            color: black;
        }

        .current-picture {
            margin-top: 10px;
        }

        .profile-preview {
            margin-top: 30px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }

        .preview-content {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }

        .preview-row {
            display: flex;
            margin-bottom: 10px;
        }

        .preview-label {
            font-weight: bold;
            min-width: 120px;
        }

        .preview-value {
            flex: 1;
        }

        /* Style for the remove button */
        .btn-outline-danger {
            border-color: #dc3545;
            color: #dc3545;
            transition: all 0.3s ease;
        }

        .btn-outline-danger:hover {
            background-color: #dc3545;
            color: white;
        }

        /* If using Bootstrap icons */
        .bi-trash {
            margin-right: 5px;
        }

        /* House Listings Section Styles */
        .house-listings-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .house-listings-actions {
            margin-bottom: 20px;
        }

        .house-listings-table {
            margin-top: 20px;
        }

        .house-listings-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .house-listings-table th,
        .house-listings-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .house-listings-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        .house-listings-table tr:hover {
            background-color: #f5f5f5;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .status-badge.available {
            background-color: #d4edda;
            color: #155724;
        }

        .status-badge.rented {
            background-color: #fff3cd;
            color: #856404;
        }

        .status-badge.archived {
            background-color: #f8d7da;
            color: #721c24;
        }

        .actions button {
            padding: 5px 10px;
            margin-right: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .btn-edit {
            background-color: #17a2b8;
            color: white;
        }

        .btn-archive {
            background-color: #6c757d;
            color: white;
        }

        .btn-activate {
            background-color: #28a745;
            color: white;
        }

        .amenities-checkboxes {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .amenity-item {
            display: flex;
            align-items: center;
        }

        .amenity-item input {
            width: auto;
            margin-right: 8px;
        }

        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .image-preview-item {
            position: relative;
            width: 100px;
            height: 100px;
        }

        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 4px;
        }

        .btn-remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .btn-remove-image:hover {
            background: rgba(0, 0, 0, 0.8);
        }

        .no-listings {
            padding: 20px;
            text-align: center;
            background: white;
            border-radius: 4px;
            border: 1px dashed #ddd;
        }

        .loading-spinner {
            padding: 20px;
            text-align: center;
        }

        .error-message {
            padding: 20px;
            color: #721c24;
            background-color: #f8d7da;
            border-radius: 4px;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-group {
            flex: 1;
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
    </style>
{% endblock %}